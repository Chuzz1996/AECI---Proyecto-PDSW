<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="edu.eci.pdsw.samples.persistence.mybatisimpl.mappers.RequestMapper">
    <resultMap type='Request' id='RequestResult'>
        <id property='id' column='Id'/>
        <result property='user_id' column='User_Id'/>
        <result property='date' column='Date'/>
        <result property='commentary' column='Commentary'/>
        <result property='state' column='State'/>
    </resultMap>
    
    <select id="getRequests" resultMap="RequestResult">
        SELECT Request.Date, Rol.Name
        FROM Request, User, Rol
        WHERE Request.User_Id = User.Id AND User.Rol_Id = Rol.Id AND Request.State = "E"
        Order By Request.Date Desc;
    </select>

    <insert id="addRequest" parameterType="map">
        INSERT INTO Request (id, User_Id, Date, Commentary,State ) 
        VALUES ( #{request.id},#{request.user_Id},#{request.date},#{request.commentary},#{request.state};   
    </insert>
    
    <update id="updateRequest" parameterType="map">
        UPDATE Request
        SET State = state, Commentary = commentary
        WHERE Id = request.id;
    </update>
  	
</mapper>